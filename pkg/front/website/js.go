// GENERATED BY textFileToGoConst
// GitHub:     github.com/logrusorgru/textFileToGoConst
// input file: html/front/website.js
// generated:  Tue Aug  9 09:48:10 CEST 2022

package website

const JS = "getWallets();\ngetWebsiteDeployerSC();\n\nlet wallets = [];\nlet deployers = [];\n\n// open file upload\nfunction openDialog(count) {\n\tconsole.log(count);\n\tdocument.getElementById('fileid0').value = null;\n\tdocument.getElementById('fileid0').click();\n}\n\n// Handle event on file selecting\nfunction handleFileSelect(evt) {\n\tlet files = evt.target.files; // get files\n\tlet f = files[0];\n\tconst reader = new FileReader();\n\treader.onload = (event) => importWallet(JSON.parse(event.target.result)); // desired file content\n\treader.onerror = (error) => reject(error);\n\treader.readAsText(f);\n}\n\nfunction errorAlert(error) {\n\tdocument.getElementsByClassName('alert-danger')[0].style.display = 'block';\n\n\tdocument.getElementsByClassName('alert-danger')[0].innerHTML = error;\n\n\tsetTimeout(function () {\n\t\tdocument.getElementsByClassName('alert-danger')[0].style.display = 'none';\n\t}, 5000);\n}\n\nfunction successMessage(message) {\n\tdocument.getElementsByClassName('alert-primary')[0].style.display = 'block';\n\n\tdocument.getElementsByClassName('alert-primary')[0].innerHTML = message;\n\n\tsetTimeout(function () {\n\t\tdocument.getElementsByClassName('alert-primary')[0].style.display = 'none';\n\t}, 5000);\n}\n// Import a wallet through PUT query\nasync function feedSelectOption(w) {\n\tconst formSelect = document.getElementsByClassName('form-select');\n\tfor (let i = 0; i < w.length; i++) {\n\t\tconst opt = document.createElement('option');\n\t\topt.value = i;\n\t\topt.text = w[i].nickname;\n\t\tformSelect[0].append(opt);\n\t}\n}\n\n// Create a wallet through POST query\nasync function getWallets() {\n\taxios\n\t\t.get('/mgmt/wallet')\n\t\t.then((resp) => {\n\t\t\tif (resp) {\n\t\t\t\tconst data = resp.data;\n\t\t\t\twallets = data;\n\t\t\t\tfeedSelectOption(wallets);\n\t\t\t}\n\t\t})\n\t\t.catch((e) => {\n\t\t\terrorAlert(e);\n\t\t});\n}\n\nasync function getWebsiteDeployerSC() {\n\taxios\n\t\t.get('/uploadWeb')\n\t\t.then((websites) => {\n\t\t\tlet count = 0;\n\t\t\tfor (const website of websites.data) {\n\t\t\t\ttableInsert(website, count);\n\t\t\t\tcount++;\n\t\t\t}\n\t\t\tdeployers = websites.data;\n\t\t})\n\t\t.catch((e) => {\n\t\t\terrorAlert(e.response.data.code);\n\t\t});\n}\n\nasync function deployWebsiteDeployerSC() {\n\tconst dnsNameInputValue = document.getElementById('websiteName').value;\n\n\tif (dnsNameInputValue == '') {\n\t\tconsole.log(dnsNameInputValue == '');\n\t\terrorAlert('Input a DNS name');\n\t} else {\n\t\tdocument.getElementsByClassName('loading')[0].style.display = 'inline-block';\n\t\tdocument.getElementsByClassName('loading')[1].style.display = 'inline-block';\n\t\taxios\n\t\t\t.post('/uploadWeb/' + dnsNameInputValue)\n\t\t\t.then((operation) => {\n\t\t\t\tdocument.getElementsByClassName('loading')[0].style.display = 'none';\n\t\t\t\tdocument.getElementsByClassName('loading')[1].style.display = 'none';\n\t\t\t\tsuccessMessage('Contract deployed to address ' + operation.data.address);\n\t\t\t})\n\t\t\t.catch((e) => {\n\t\t\t\terrorAlert(e.response.data.code);\n\t\t\t});\n\t}\n}\n\nfunction tableInsert(resp, count) {\n\tconst tBody = document.getElementById('website-deployers-table').getElementsByTagName('tbody')[0];\n\tconst row = tBody.insertRow(-1);\n\tconst url = 'http://' + resp.name + '.massa/';\n\n\tconst cell0 = row.insertCell();\n\tconst cell1 = row.insertCell();\n\tconst cell2 = row.insertCell();\n\tconst cell3 = row.insertCell();\n\n\tcell0.innerHTML = resp.name;\n\tcell1.innerHTML = resp.address;\n\tcell2.innerHTML = \"<a href='\" + url + \"'>\" + url + '</a>';\n\tcell3.innerHTML =\n\t\t\"<div><input id='fileid\" +\n\t\tcount +\n\t\t\"' type='file' hidden/><button id='upload-website\" +\n\t\tcount +\n\t\t\"'\" +\n\t\t\"class='primary-button' id='buttonid' type='button' value='Upload MB' >Upload</button><span style='display: none' class='spinner-border loading\" +\n\t\tcount +\n\t\t\"' role='status'><img src='./logo.png' class='massa-logo-spinner' alt='Massa logo' /></span></div> \";\n\n\tdocument.getElementById(`upload-website${count}`).addEventListener('click', function () {\n\t\tdocument.getElementById(`fileid${count}`).value = null;\n\t\tdocument.getElementById(`fileid${count}`).click();\n\t});\n\n\tdocument.getElementById(`fileid${count}`).addEventListener('change', function (evt) {\n\t\tlet files = evt.target.files; // get files\n\t\tlet f = files[0];\n\t\tuploadWebsite(f, count);\n\t});\n}\n\nfunction uploadWebsite(file, count) {\n\tconst bodyFormData = new FormData();\n\tbodyFormData.append('zipfile', file);\n\tdocument.getElementsByClassName('loading' + count)[0].style.display = 'inline-block';\n\taxios({\n\t\turl: `/fillWeb/${deployers[count].address}`,\n\t\tmethod: 'POST',\n\t\tdata: bodyFormData,\n\t\theaders: {\n\t\t\t'Content-Type': 'multipart/form-data',\n\t\t},\n\t})\n\t\t.then((operation) => {\n\t\t\tdocument.getElementsByClassName('loading' + count)[0].style.display = 'none';\n\t\t\tsuccessMessage('Website uploaded with operation ID : ' + operation);\n\t\t})\n\t\t.catch((e) => {\n\t\t\terrorAlert(e.response.data.code);\n\t\t});\n}\n"
